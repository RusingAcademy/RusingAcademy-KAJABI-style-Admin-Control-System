{
  "query": "-- Owner gets ALL permissions\nINSERT INTO role_permissions (roleId, permissionId)\nSELECT r.id, p.id FROM roles r CROSS JOIN permissions p WHERE r.name = 'owner'\nON DUPLICATE KEY UPDATE roleId = roleId;\n\n-- Superadmin gets ALL permissions\nINSERT INTO role_permissions (roleId, permissionId)\nSELECT r.id, p.id FROM roles r CROSS JOIN permissions p WHERE r.name = 'superadmin'\nON DUPLICATE KEY UPDATE roleId = roleId;\n\n-- Admin gets everything except settings.rbac.edit and settings.general.edit\nINSERT INTO role_permissions (roleId, permissionId)\nSELECT r.id, p.id FROM roles r CROSS JOIN permissions p \nWHERE r.name = 'admin' \nAND NOT (p.module = 'settings' AND p.submodule = 'rbac' AND p.action = 'edit')\nAND NOT (p.module = 'settings' AND p.submodule = 'general' AND p.action = 'edit')\nON DUPLICATE KEY UPDATE roleId = roleId;\n\n-- HR Manager gets people.*, insights.*, products.view\nINSERT INTO role_permissions (roleId, permissionId)\nSELECT r.id, p.id FROM roles r CROSS JOIN permissions p \nWHERE r.name = 'hr_manager' \nAND (p.module = 'people' OR p.module = 'insights' OR (p.module = 'products' AND p.action = 'view'))\nON DUPLICATE KEY UPDATE roleId = roleId;\n\n-- Coach gets products.coaching.*, people.learners.view, insights.analytics.view\nINSERT INTO role_permissions (roleId, permissionId)\nSELECT r.id, p.id FROM roles r CROSS JOIN permissions p \nWHERE r.name = 'coach' \nAND ((p.module = 'products' AND p.submodule = 'coaching')\n  OR (p.module = 'people' AND p.submodule = 'learners' AND p.action = 'view')\n  OR (p.module = 'insights' AND p.submodule = 'analytics' AND p.action = 'view'))\nON DUPLICATE KEY UPDATE roleId = roleId;\n\n-- Editor gets products.courses.*, website.*, products.coaching.view\nINSERT INTO role_permissions (roleId, permissionId)\nSELECT r.id, p.id FROM roles r CROSS JOIN permissions p \nWHERE r.name = 'editor' \nAND ((p.module = 'products' AND p.submodule = 'courses')\n  OR p.module = 'website'\n  OR (p.module = 'products' AND p.submodule = 'coaching' AND p.action = 'view'))\nON DUPLICATE KEY UPDATE roleId = roleId;\n\n-- Viewer gets all view permissions\nINSERT INTO role_permissions (roleId, permissionId)\nSELECT r.id, p.id FROM roles r CROSS JOIN permissions p \nWHERE r.name = 'viewer' AND p.action = 'view'\nON DUPLICATE KEY UPDATE roleId = roleId;",
  "command": "mysql --batch --raw --column-names --default-character-set=utf8mb4 --host gateway03.us-east-1.prod.aws.tidbcloud.com --port 4000 --user cYPAHDVF1MZtM6S.6044338ada58 --database cwh3JmcrqYgAZTUAinEMzM --execute -- Owner gets ALL permissions\nINSERT INTO role_permissions (roleId, permissionId)\nSELECT r.id, p.id FROM roles r CROSS JOIN permissions p WHERE r.name = 'owner'\nON DUPLICATE KEY UPDATE roleId = roleId;\n\n-- Superadmin gets ALL permissions\nINSERT INTO role_permissions (roleId, permissionId)\nSELECT r.id, p.id FROM roles r CROSS JOIN permissions p WHERE r.name = 'superadmin'\nON DUPLICATE KEY UPDATE roleId = roleId;\n\n-- Admin gets everything except settings.rbac.edit and settings.general.edit\nINSERT INTO role_permissions (roleId, permissionId)\nSELECT r.id, p.id FROM roles r CROSS JOIN permissions p \nWHERE r.name = 'admin' \nAND NOT (p.module = 'settings' AND p.submodule = 'rbac' AND p.action = 'edit')\nAND NOT (p.module = 'settings' AND p.submodule = 'general' AND p.action = 'edit')\nON DUPLICATE KEY UPDATE roleId = roleId;\n\n-- HR Manager gets people.*, insights.*, products.view\nINSERT INTO role_permissions (roleId, permissionId)\nSELECT r.id, p.id FROM roles r CROSS JOIN permissions p \nWHERE r.name = 'hr_manager' \nAND (p.module = 'people' OR p.module = 'insights' OR (p.module = 'products' AND p.action = 'view'))\nON DUPLICATE KEY UPDATE roleId = roleId;\n\n-- Coach gets products.coaching.*, people.learners.view, insights.analytics.view\nINSERT INTO role_permissions (roleId, permissionId)\nSELECT r.id, p.id FROM roles r CROSS JOIN permissions p \nWHERE r.name = 'coach' \nAND ((p.module = 'products' AND p.submodule = 'coaching')\n  OR (p.module = 'people' AND p.submodule = 'learners' AND p.action = 'view')\n  OR (p.module = 'insights' AND p.submodule = 'analytics' AND p.action = 'view'))\nON DUPLICATE KEY UPDATE roleId = roleId;\n\n-- Editor gets products.courses.*, website.*, products.coaching.view\nINSERT INTO role_permissions (roleId, permissionId)\nSELECT r.id, p.id FROM roles r CROSS JOIN permissions p \nWHERE r.name = 'editor' \nAND ((p.module = 'products' AND p.submodule = 'courses')\n  OR p.module = 'website'\n  OR (p.module = 'products' AND p.submodule = 'coaching' AND p.action = 'view'))\nON DUPLICATE KEY UPDATE roleId = roleId;\n\n-- Viewer gets all view permissions\nINSERT INTO role_permissions (roleId, permissionId)\nSELECT r.id, p.id FROM roles r CROSS JOIN permissions p \nWHERE r.name = 'viewer' AND p.action = 'view'\nON DUPLICATE KEY UPDATE roleId = roleId;",
  "returncode": 1,
  "logs": [
    "ERROR 1054 (42S22) at line 2: Unknown column 'roleId' in 'field list'"
  ]
}